# 币安合约 EMA/MA交叉策略自动化交易系统

基于EMA(5)和MA(10)指标的自动化交易策略系统，使用币安合约API获取K 线数据进行。

## 功能特性

- 🔄 自动获取币安K线数据,具体是 1m 还是 5m,根据配置文件里的参数来设置,保存在数据库
- 📊 计算EMA(5)和MA(15)技术指标
- 🎯 金叉/死叉信号检测,
- 💰 模拟交易系统（1000 USDT初始资金，每次开仓钱包里的 50%，10倍杠杆）
- 📈 完整的测试报告和统计分析
- ⚙️ 配置文件管理所有参数
- **数据库存储**: SQLite数据库存储所有交易数据,包括 K 线数据,交易记录,钱包余额等
- **模拟模式**: 支持模拟交易和真实交易模式,通过配置文件里的参数来设置,默认是模拟交易模式
- **交易记录**: 所有开仓平仓操作,包括时间,价格,数量,方向,手续费等
- **资金流水**: 每笔交易的资金变动,包括开仓,平仓,手续费等,保存在数据库
- **实时显示**: 所有信息都会实时显示在WEB 页面,包括当前时间,当前价格,当前EMA,当前MA,当前仓位,当前钱包余额,当前持仓量,当前持仓价值,当前手续费,当前利润,交易记录等等

## 交易策略

- **金叉信号**: 当EMA(5)从下方穿越MA(15)时，执行买入操作
- **死叉信号**: 当EMA(5)从上方穿越MA(15)时，执行卖出操作

**做多条件**:
  - EMA金叉MA // 当 EMA(5) 从下方穿越 MA(15) 时
  - 价格在EMA上方
  - EMA在MA上方
  - EMA呈上升趋势

**做空条件**:
  - EMA死叉MA // 当 EMA(5) 从上方穿越 MA(15) 时
  - 价格在EMA下方
  - EMA在MA下方
  - EMA呈下降趋势

**多头平仓**:
  - EMA死叉MA // 当 EMA(5) 从上方穿越 MA(15) 时
  - 价格跌破EMA

**空头平仓**:
  - EMA金叉MA // 当 EMA(5) 从下方穿越 MA(15) 时
  - 价格突破EMA

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置说明

编辑 `config.json` 文件来调整交易参数(也可使用config.py文件)：

```json
{
  "trading": {
    "api_key": "your_api_key_here", // 币安合约 API 密钥,
    "secret_key": "your_secret_key_here", // 币安合约 API 密钥
    "test_mode": true, // 测试模式,默认是 true,如果设置为 false,则会使用 api_key执行真实交易
    
    "initial_balance": 1000,    // 初始资金(USDT)
    "buy_amount": initial_balance * percent,       // 每次开仓金额,初始金额为 1000,第二次开仓就是加上盈亏后的金额(USDT)
    "percent": 0.5,              // 每次开仓金额占资金的比例
    "leverage": 10,              // 杠杆倍数
    "fee_rate": 0.0005,         // 交易手续费率,0.05%
    "symbol": "BTCUSDT",         // 交易对
    "interval": "1m",            // K线周期
    "data_period_days": 1       // 数据获取天数
    "base_url": "https://www.binance.com/zh-CN/futures/BTCUSDT" // 币安合约 API 基础 URL
  },
  "indicators": {
    "ema_period": 5,             // EMA周期
    "ma_period": 15              // MA周期
  }
}
```

## 使用方法
在虚拟环境中运行,自动适配 MACOS 和 UBUNTU SERVER 系统

1. **安装依赖**:
   ```bash
   pip install -r requirements.txt
   ```

2. **运行策略**:
   ```bash
   python web_main.py
   ```

3. **查看结果**:
   - 控制台会显示实时交易信号,实时交易状态,实时合约价格,实时 EMA/MA 价格,实时钱包余额
   - 控制台会显示 5 条最新交易记录,5 条最新 K 线数据,其中最新一条未收盘 K 线会实时更新价格
   - 详细的日志记录,详细的代码注释,方便调试和维护

## 项目结构

```
ema-ma/
├── web_main.py                 # 主程序入口
├── binance_client.py       # 币安API客户端
├── binance_websocket.py    # 币安Websocket客户端
├── indicators.py           # 技术指标计算
├── trading.py              # 交易系统,包含模拟交易和真实交易模式,通过配置文件里的参数来设置,默认是模拟交易模式
├── config.json            # 配置文件
├── requirements.txt       # 依赖包列表
└── README.md             # 说明文档
├── db/
│   └── trading.db        # SQLite数据库文件
├── deploy.sh         # 部署脚本,自适应 MACOS 和 UBUNTU SERVER 系统,自动安装依赖,设置权限,启动服务
```
## 交易流程

1. **启动程序**: 运行 `web_main.py` 启动程序,会自动连接币安合约 API,获取100 根最新 K 线数据,计算 EMA/MA 指标,保存在数据库,并启动交易系统;同时使用 WEBSOKET 客户端接收币安实时合约价格和未收盘的实时 K 线数据,实时计算 EMA/MA 指标,触发交易,执行交易
2. **配置参数**: 在 `config.json` 文件中配置交易参数,包括 API 密钥,测试模式,初始资金,每次开仓金额占资金的比例,杠杆倍数,交易手续费率,交易对,时间周期,币安合约 API 基础 URL 等等
3. **查看交易状态**: 在浏览器中打开 `http://localhost:5001` 查看交易状态,包括当前时间,当前价格,当前EMA,当前MA,当前仓位,当前钱包余额,当前持仓量,当前持仓价值,当前手续费,当前利润,交易记录等等
4. **监控交易**: 程序会实时监控交易状态,包括金叉/死叉信号,价格变化,钱包余额变化,持仓量变化,持仓价值变化,手续费变化,利润变化等等

## 注意事项

1. **网络连接**: 需要稳定的网络连接来获取币安API数据,特别是 WEBSOKET 的心跳和重连机制
2. **数据限制**: 币安API有请求频率限制，建议适当控制请求频率,程序启动时,使用 API 一次性获取数据,保存在数据库,后续从数据库中读取数据,实时数据使用 WEBSOKET 实时推送
3. **模拟交易**: 当前版本仅支持模拟交易，不会执行真实交易,通过配置文件里的开关可以切换模拟交易和真实交易,默认是模拟交易
4. **时区问题**: 程序默认使用 UTC 时间,但是在 WEB 页面显示时,要转换为用户所在时区时间UTC +8

## 扩展功能
保持程序的可扩展性,方便后续添加其他交易策略,其他技术指标,其他交易对,其他时间周期等

## UI 界面 参考图例

![UI 界面 参考图例](1.png)
![UI 界面 参考图例](2.png)
![UI 界面 参考图例](3.png)
![UI 界面 参考图例](4.png)
![UI 界面 参考图例](5.png)



## 许可证

MIT License